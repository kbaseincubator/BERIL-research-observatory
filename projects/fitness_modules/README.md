# Pan-bacterial Fitness Modules via Independent Component Analysis

## Research Question

Can we decompose RB-TnSeq fitness compendia into latent functional modules via robust ICA, align them across organisms using orthology, and use module context to predict gene function?

## Motivation

The Fitness Browser (fit.genomics.lbl.gov) provides fitness scores for ~228K genes across ~7,500 experiments in 48 bacteria. Current analysis relies on **edge-based** approaches (cofitness between gene pairs). This project upgrades to **module-based** analysis:

- **Modules** = groups of genes that respond coherently across conditions (independent components)
- **Cross-organism alignment** = modules from different organisms matched via ortholog fingerprints
- **Function prediction** = unannotated genes inherit function from their module's enrichment

This approach follows Borchert et al. (2019) who applied ICA to *P. putida* fitness data, but extends it to a pan-bacterial framework.

## Approach

### Phase 1: Pilot (5 data-rich organisms)

1. **Explore & select** — Survey all 48 organisms; pick ~5 by data richness (experiment count, gene count, ortholog connectivity)
2. **Extract matrices** — Build gene × experiment fitness matrices from Spark
3. **Robust ICA** — 100× FastICA runs → DBSCAN clustering → stable modules
4. **Annotate modules** — KEGG, SEED, domain enrichment; map to conditions
5. **Cross-organism alignment** — BBH ortholog groups → module family fingerprints
6. **Predict function** — Module + family context → function for hypothetical proteins
7. **Benchmark** — Compare to cofitness voting, ortholog transfer, domain-only baselines

### Phase 2: Scale to all 48 organisms

Extend pipeline after validating on pilot set.

## Key Methods

- **Robust ICA**: FastICA with 30-50 random restarts, 32-80 components (capped at 40% of experiments); components clustered by |cosine similarity| (DBSCAN eps=0.15) to identify stable modules
- **Module membership**: Absolute weight threshold (|Pearson r| ≥ 0.3 with module profile, max 50 genes per module)
- **Cross-organism matching**: Convert modules to ortholog-group fingerprints; cosine similarity → hierarchical clustering into families
- **Function prediction**: Module enrichment label × |gene weight| × cross-organism consistency

## Data Sources

All from `kescience_fitnessbrowser` on BERDL:

| Table | Use |
|-------|-----|
| `organism` | Organism metadata, pilot selection |
| `gene` | Gene coordinates, descriptions |
| `experiment` | Condition metadata, QC metrics |
| `genefitness` | Fitness scores (27M rows) |
| `fitbyexp_*` | Pre-pivoted fitness matrices |
| `ortholog` | BBH pairs for cross-organism alignment |
| `cofit` | Baseline comparison |
| `keggmember`, `seedannotation`, `genedomain` | Functional annotations for enrichment |
| `specificphenotype` | Condition-gene associations |

## Project Structure

```
projects/fitness_modules/
├── README.md
├── notebooks/
│   ├── 01_explore_and_select.ipynb     # Data landscape, pick pilot organisms
│   ├── 02_extract_matrices.ipynb       # Gene-fitness matrices from Spark
│   ├── 03_ica_modules.ipynb            # Robust ICA → modules
│   ├── 04_module_annotation.ipynb      # Functional enrichment of modules
│   ├── 05_cross_organism_alignment.ipynb # Module families via ortholog fingerprints
│   ├── 06_function_prediction.ipynb    # Predict function for unannotated genes
│   └── 07_benchmarking.ipynb           # Evaluate vs baselines
├── src/
│   └── ica_pipeline.py                 # Reusable FastICA + DBSCAN stability code
├── data/
│   ├── matrices/       # Per-organism fitness matrices
│   ├── modules/        # ICA module definitions + weights
│   ├── annotations/    # Gene/experiment metadata + functional annotations
│   ├── orthologs/      # BBH pairs + ortholog groups
│   ├── module_families/ # Cross-organism aligned families
│   └── predictions/    # Function predictions + benchmarks
└── figures/
```

## Expected Outcomes

1. **Stable fitness modules** (5-50 genes each) for pilot organisms with biological labels
2. **Conserved module families** shared across 3+ organisms — the pan-bacterial fitness regulon catalog
3. **Function predictions** for hypothetical proteins with confidence scores
4. **Benchmark showing** module-based predictions outperform cofitness voting alone

## Results

### ICA Decomposition (32 organisms)
- **1,077 stable modules** across 32 organisms (all with ≥100 experiments)
- Module sizes: median 7-50 genes per module (biologically correct range)
- **93.2%** of modules show elevated within-module cofitness vs genome-wide background
- Within-module gene correlation: 17-138x above random pairs

### Cross-Organism Alignment
- 27 module families spanning 2+ organisms via BBH ortholog fingerprints
- 3 annotated families with consensus functional labels

### Function Prediction
- **878 function predictions** for hypothetical proteins across 29 organisms
- 36 unique predicted functions
- Predictions backed by module enrichment (KEGG, SEED, TIGRFam)

### Key Finding
The strict membership threshold (|weight| ≥ 0.3, max 50 genes) was critical. The initial D'Agostino K² approach gave 100-280 genes per module with weak cofitness signal (59% enriched, 1-17x correlation). After switching to absolute weight thresholds, modules became biologically coherent (93% enriched, 17-138x correlation).

## Authors

- **Paramvir S. Dehal** (ORCID: [0000-0001-5810-2497](https://orcid.org/0000-0001-5810-2497)) — Lawrence Berkeley National Laboratory

## References

- Borchert AJ et al. (2019). "Proteome and transcriptome analysis of *Pseudomonas putida* KT2440 using independent component analysis." *mBio*.
- Price MN et al. (2018). "Mutant phenotypes for thousands of bacterial genes of unknown function." *Nature*.
- Hyvärinen A & Oja E (2000). "Independent component analysis: algorithms and applications." *Neural Networks*.
