---
reviewer: BERIL Automated Review
date: 2026-02-16
project: enigma_contamination_functional_potential
---

# Review: Contamination Gradient vs Functional Potential in ENIGMA Communities

## Summary
This project is clear, reproducible, and technically solid: the question is testable, the notebook sequence is coherent, outputs/figures are present, and `REPORT.md` conclusions match the generated TSVs. The analysis is appropriately cautious about null primary tests and sensitivity-dependent signals. The main gaps are statistical inference control across many tests and potential confounding from collapsing multiple community fractions into one per-sample profile.

## Methodology
The research question and hypotheses are explicit in `README.md` and `RESEARCH_PLAN.md`, with concrete source tables from `enigma_coral` and `kbase_ke_pangenome`. The execution flow is logical: extraction/QC in `notebooks/01_enigma_extraction_qc.ipynb`, taxonomy bridge + feature engineering in `notebooks/02_taxonomy_bridge_functional_features.ipynb`, then modeling in `notebooks/03_contamination_functional_models.ipynb`.

Reproducibility is strong. `README.md` includes a clear `## Reproduction` section with execution order, Spark/local separation, expected runtimes, and output artifacts. `requirements.txt` is present. All 3 notebooks have saved outputs in executed code cells; in NB03, the only code cells without outputs are intentional comment-only placeholders.

Methodologically, the strict/relaxed/species-proxy mapping split in NB02 is a useful sensitivity design and is correctly propagated into NB03. A key limitation is mapping coverage: `data/taxon_bridge.tsv` shows 862 unmapped genera out of 1,392 observed genera, so inference is conditional on mapped taxa and modeled coverage.

## Code Quality
Notebook code is generally good quality. In `notebooks/01_enigma_extraction_qc.ipynb` (code cell 4), large aggregations stay in Spark before collecting, which aligns with `docs/pitfalls.md` guidance. Explicit casting is used where ENIGMA numeric fields may be string-typed. In `notebooks/02_taxonomy_bridge_functional_features.ipynb` (code cell 6), the annotation join uses `gene_cluster.gene_cluster_id = eggnog_mapper_annotations.query_name`, matching the documented pitfall. In `notebooks/03_contamination_functional_models.ipynb` (code cell 4), status handling for insufficient/constant cases is implemented and persisted in `data/model_results.tsv`.

No clear runtime bug was found in executed paths. Two quality risks remain:
1. Inference multiplicity: many p-values are reported across outcomes, mapping modes, and sensitivity models, without explicit multiple-testing correction.
2. Potential aggregation confounding: `notebooks/03_contamination_functional_models.ipynb` (code cell 3) collapses all community rows to sample-genus abundance, while NB01 reports 212 communities for 108 samples; combining multiple filter fractions into one profile may blur biologically distinct community strata.

## Findings Assessment
`REPORT.md` is consistent with artifacts. Claims on null primary tests, coverage-adjusted defense associations, and high-coverage subset signals match values in `data/model_results.tsv` and `data/site_functional_scores.tsv`. Figure files referenced in the report are present in `figures/` and consistent with notebook outputs.

Interpretation is appropriately conservative and limitations are acknowledged (genus-level abstraction, coarse COG proxies, incomplete mapping, site-structure simplification). The write-up avoids causal overstatement and treats positive signals as conditional sensitivity evidence.

## Suggestions
1. [High] Add multiple-testing correction (for example BH-FDR) across outcome x mapping-mode x sensitivity analyses, and report adjusted p-values alongside raw p-values in `data/model_results.tsv` and `REPORT.md`.
2. [High] Separate confirmatory vs exploratory models in NB03 (pre-declare primary endpoint/model) so significant sensitivity results are interpreted in a controlled inference framework.
3. [High] Test robustness to community-fraction aggregation by re-running core analyses stratified by `sdt_community_name` type (for example filter fraction), or include fraction/community-type covariates before collapsing to sample-level.
4. [Medium] Add effect-size uncertainty intervals (bootstrap CIs) for key contamination associations, not only p-values.
5. [Medium] Expand site-structure handling beyond `C(location_prefix)` where feasible (for example mixed-effects location random intercepts or date-aware models).
6. [Medium] Quantify mapping uncertainty more explicitly by modeling interaction between contamination and `mapped_abundance_fraction`, not only threshold-based high-coverage subsets.

## Review Metadata
- **Reviewer**: BERIL Automated Review
- **Date**: 2026-02-16
- **Scope**: README.md, 3 notebooks, 7 data files, 3 figures
- **Note**: This review was generated by an AI system. It should be treated as advisory input, not a definitive assessment.
