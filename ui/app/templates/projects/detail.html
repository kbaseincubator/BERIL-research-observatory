{% extends "base.html" %}

{% block title %}{{ project.title }} - {{ app_name }}{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav class="mb-8">
    <a href="/projects" class="text-muted">Projects</a>
    <span class="text-muted"> / </span>
    <span>{{ project.title }}</span>
</nav>

<div class="page-header">
    <div class="flex items-center gap-4 mb-4">
        <h1 class="page-title" style="margin-bottom: 0;">{{ project.title }}</h1>
        {% if project.status.value == "Completed" %}
        <span class="badge badge-completed">{{ project.status.value }}</span>
        {% elif project.status.value == "In Progress" %}
        <span class="badge badge-in-progress">{{ project.status.value }}</span>
        {% else %}
        <span class="badge badge-proposed">{{ project.status.value }}</span>
        {% endif %}
    </div>
    <div style="margin-top: var(--space-2);">
        <span class="text-muted text-small">Project:</span>
        <span class="badge badge-project" style="margin-left: var(--space-2);">
            {{ project.id | replace('_', ' ') | title }}
        </span>
    </div>
</div>

<!-- Research Question -->
<section class="section">
    <h2>Research Question</h2>
    <div class="page-description markdown-content">{{ project.research_question | markdown }}</div>
</section>

<!-- Hypothesis -->
{% if project.hypothesis %}
<section class="section">
    <h2>Hypothesis</h2>
    <div class="card markdown-content">
        {{ project.hypothesis | markdown }}
    </div>
</section>
{% endif %}

<!-- Approach -->
{% if project.approach %}
<section class="section">
    <h2>Approach</h2>
    <div class="card markdown-content">
        {{ project.approach | markdown }}
    </div>
</section>
{% endif %}

<!-- Key Findings -->
{% if project.findings and 'to be filled' not in project.findings.lower() %}
<section class="section">
    <h2>Key Findings</h2>
    <div class="card markdown-content" style="border-left: 4px solid var(--accent-primary);">
        {{ project.findings | markdown }}
    </div>
</section>
{% endif %}

<!-- Authors -->
{% if project.contributors %}
<section class="section">
    <h2>Authors</h2>
    <div class="contributors-list">
        {% for contributor in project.contributors %}
        <div class="contributor-card">
            <div class="contributor-info">
                <span class="contributor-name">{{ contributor.name }}</span>
                {% if contributor.affiliation %}
                <span class="contributor-affiliation">({{ contributor.affiliation }})</span>
                {% endif %}
            </div>
            <div class="contributor-meta">
                {% if contributor.orcid %}
                <a href="{{ contributor.orcid_url }}" target="_blank" rel="noopener" class="orcid-link">
                    <img src="https://info.orcid.org/wp-content/uploads/2019/11/orcid_16x16.png" alt="ORCID" width="16" height="16">
                    {{ contributor.orcid }}
                </a>
                {% endif %}
                {% if contributor.roles %}
                <span class="contributor-roles">{{ contributor.roles | join(', ') }}</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Visualizations -->
{% if project.visualizations %}
<section class="section">
    <h2>Visualizations</h2>
    <div class="grid grid-3">
        {% for viz in project.visualizations %}
        <div class="card" style="padding: var(--space-3);">
            <img
                src="/project-assets/{{ viz.path | replace('projects/', '', 1) }}"
                alt="{{ viz.title }}"
                style="width: 100%; height: auto; border-radius: var(--radius-sm);"
                loading="lazy"
            >
            <p class="text-small text-muted mt-4" style="margin-bottom: 0;">{{ viz.title }}</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Notebooks -->
{% if project.notebooks %}
<section class="section">
    <h2>Notebooks</h2>
    <div class="grid grid-2">
        {% for notebook in project.notebooks %}
        <a href="/projects/{{ project.id }}/notebooks/{{ notebook.filename }}" class="card" style="text-decoration: none;">
            <div class="flex items-center gap-4">
                <span style="font-size: 1.5rem; color: var(--accent-primary);">&#128196;</span>
                <div>
                    <code style="color: var(--text-primary);">{{ notebook.filename }}</code>
                    {% if notebook.title %}
                    <p class="text-muted text-small mt-4" style="margin-bottom: 0;">{{ notebook.title }}</p>
                    {% endif %}
                </div>
            </div>
            <p class="text-small mt-4" style="margin-bottom: 0; color: var(--text-link);">View notebook &rarr;</p>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Data Files -->
{% if project.data_files %}
<section class="section">
    <h2>Data Files</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Filename</th>
                <th>Size</th>
            </tr>
        </thead>
        <tbody>
            {% for file in project.data_files %}
            <tr>
                <td><code>{{ file.filename }}</code></td>
                <td>{{ "%.1f"|format(file.size_bytes / 1024) }} KB</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}
{% endblock %}
