{% extends "base.html" %}

{% block title %}{{ app_name }} - AI-Powered Exploration of the KBase Data Lakehouse{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1 class="hero-title">
            <span class="accent">BERIL</span><br>
            Research Observatory
        </h1>
        <p class="hero-description">
            AI-powered exploration of the KBase Data Lakehouse. Discover research findings,
            explore collection schemas, and contribute to shared scientific knowledge.
        </p>
        <div class="hero-actions">
            <a href="/collections" class="btn btn-primary">Explore Collections</a>
            <a href="/projects" class="btn btn-secondary">Browse Projects</a>
        </div>
    </div>

    <div class="hero-stats">
        <div class="stat-card">
            <div class="stat-value">{{ collection_count }}</div>
            <div class="stat-label">collections</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_genomes }}</div>
            <div class="stat-label">genomes</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ discovery_count }}</div>
            <div class="stat-label">discoveries</div>
        </div>
    </div>
</section>

<!-- What is BERIL -->
<section class="section">
    <div class="card" style="border-left: 4px solid var(--accent-primary);">
        <h2 style="margin-bottom: var(--space-4);">What is BERIL?</h2>
        <p>
            <strong>BERIL</strong> is an AI integration layer for the <strong>KBase BER Data Lakehouse (BERDL)</strong>.
            It provides resources, skills, and plugins that enable AI agents and human researchers to analyze
            BERDL data collaboratively. Through the Research Observatory, users can explore multiple data
            collections, analyze their own data in context, and share discoveries with proper attribution.
        </p>
    </div>
</section>

<!-- Featured Collections -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">Featured Collections</h2>
        <a href="/collections" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        <a href="/collections/kbase_ke_pangenome" class="card">
            <div class="card-header">
                <span style="font-size: 1.5rem;">&#129516;</span>
                <span class="badge" style="background: rgba(57, 212, 230, 0.15); color: #39d4e6;">Primary</span>
            </div>
            <h3 class="card-title" style="color: var(--text-primary);">Pangenome Collection</h3>
            <p class="text-muted text-small" style="font-family: var(--font-mono);">kbase_ke_pangenome</p>
            <div class="card-content">
                <p class="text-small">293,059 genomes across 27,690 microbial species. Core/accessory gene classification, functional annotations, ANI relationships.</p>
            </div>
            <div class="card-footer">
                <span class="text-small text-muted">14 tables</span>
            </div>
        </a>

        <a href="/collections/kescience_fitnessbrowser" class="card">
            <div class="card-header">
                <span style="font-size: 1.5rem;">&#128202;</span>
                <span class="badge" style="background: rgba(57, 212, 230, 0.15); color: #39d4e6;">Primary</span>
            </div>
            <h3 class="card-title" style="color: var(--text-primary);">Fitness Browser</h3>
            <p class="text-muted text-small" style="font-family: var(--font-mono);">kescience_fitnessbrowser</p>
            <div class="card-content">
                <p class="text-small">Gene fitness data from transposon mutant experiments across 40+ bacterial organisms. Essential genes and condition-specific phenotypes.</p>
            </div>
            <div class="card-footer">
                <span class="text-small text-muted">90+ tables</span>
            </div>
        </a>

        <a href="/collections/kbase_msd_biochemistry" class="card">
            <div class="card-header">
                <span style="font-size: 1.5rem;">&#9879;</span>
                <span class="badge" style="background: rgba(57, 212, 230, 0.15); color: #39d4e6;">Primary</span>
            </div>
            <h3 class="card-title" style="color: var(--text-primary);">ModelSEED Biochemistry</h3>
            <p class="text-muted text-small" style="font-family: var(--font-mono);">kbase_msd_biochemistry</p>
            <div class="card-content">
                <p class="text-small">Biochemistry reference data for metabolic modeling. Reactions, compounds, and pathway mappings.</p>
            </div>
            <div class="card-footer">
                <span class="text-small text-muted">4 tables</span>
            </div>
        </a>
    </div>
</section>

<!-- Latest Discoveries -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">Latest Discoveries</h2>
        <a href="/knowledge/discoveries" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        {% for discovery in discoveries %}
        <article class="card">
            <div class="card-header">
                <span class="badge" style="background: rgba(57, 212, 230, 0.15); color: #39d4e6;">Pangenome</span>
            </div>
            <h3 class="card-title">
                <a href="/knowledge/discoveries#{{ discovery.id }}">{{ discovery.title }}</a>
            </h3>
            <div class="card-content">
                <p>{{ discovery.content[:200] }}{% if discovery.content|length > 200 %}...{% endif %}</p>
            </div>
            {% if discovery.date %}
            <div class="card-footer">
                <span class="text-muted text-small">{{ discovery.date.strftime('%B %Y') }}</span>
            </div>
            {% endif %}
        </article>
        {% else %}
        <p class="text-muted">No discoveries yet. Start analyzing!</p>
        {% endfor %}
    </div>
</section>

<!-- Active Projects -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">Active Projects</h2>
        <a href="/projects" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        {% for project in projects %}
        <article class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <a href="/projects/{{ project.id }}">{{ project.title }}</a>
                </h3>
                {% if project.status.value == "Completed" %}
                <span class="badge badge-completed">{{ project.status.value }}</span>
                {% elif project.status.value == "In Progress" %}
                <span class="badge badge-in-progress">{{ project.status.value }}</span>
                {% else %}
                <span class="badge badge-proposed">{{ project.status.value }}</span>
                {% endif %}
            </div>
            <div class="card-content">
                <p>{{ project.research_question[:150] }}{% if project.research_question|length > 150 %}...{% endif %}</p>
            </div>
            <div class="card-footer">
                <div class="card-meta">
                    {% if project.notebooks %}
                    <span>{{ project.notebooks|length }} notebooks</span>
                    {% endif %}
                    {% if project.visualizations %}
                    <span>{{ project.visualizations|length }} figures</span>
                    {% endif %}
                </div>
                <a href="/projects/{{ project.id }}" class="btn btn-secondary">View</a>
            </div>
        </article>
        {% else %}
        <p class="text-muted">No projects yet. Start researching!</p>
        {% endfor %}
    </div>
</section>

<!-- Quick Links -->
<section class="section">
    <h2 class="section-title">Get Started</h2>

    <div class="grid grid-4">
        <a href="/collections" class="card">
            <h4>Browse Collections</h4>
            <p class="text-muted text-small">Explore BERDL data collections and schemas</p>
        </a>
        <a href="/knowledge/pitfalls" class="card">
            <h4>Query Pitfalls</h4>
            <p class="text-muted text-small">Common gotchas and how to avoid them</p>
        </a>
        <a href="/knowledge/ideas" class="card">
            <h4>Research Ideas</h4>
            <p class="text-muted text-small">{{ idea_count }} ideas waiting to be explored</p>
        </a>
        <a href="/about" class="card">
            <h4>About BERIL</h4>
            <p class="text-muted text-small">Learn about the platform</p>
        </a>
    </div>
</section>
{% endblock %}
