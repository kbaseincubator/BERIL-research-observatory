{% extends "base.html" %}

{% block title %}{{ app_name }} - AI Co-Scientist for Microbial Discovery{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1 class="hero-title">
            <span class="accent">Microbial Discovery</span><br>
            Forge
        </h1>
        <p class="hero-description">
            An AI co-scientist and research observatory for BERDL-scale microbial
            discovery â€” powered by reusable skills, shared memory, and scalable data.
        </p>
        <div class="hero-actions">
            <a href="/co-scientist" class="btn btn-primary">Explore Co-Scientist</a>
            <a href="/knowledge/discoveries" class="btn btn-secondary">Browse Discoveries</a>
            <a href="/collections" class="btn btn-secondary">Explore Data</a>
        </div>
    </div>

    <div class="hero-stats">
        <a href="/projects" class="stat-card">
            <div class="stat-value">{{ project_count }}</div>
            <div class="stat-label">projects</div>
        </a>
        <a href="/knowledge/discoveries" class="stat-card">
            <div class="stat-value">{{ discovery_count }}</div>
            <div class="stat-label">discoveries</div>
        </a>
        <a href="/skills" class="stat-card">
            <div class="stat-value">{{ skill_count }}</div>
            <div class="stat-label">skills</div>
        </a>
        <a href="/collections" class="stat-card">
            <div class="stat-value">{{ collection_count }}</div>
            <div class="stat-label">collections</div>
        </a>
    </div>
</section>

<!-- Two Experiences -->
<section class="section">
    <div class="grid grid-2">
        <div class="card" style="border-left: 4px solid var(--accent-primary);">
            <h2 style="margin-bottom: var(--space-4);">AI Co-Scientist</h2>
            <p>
                A human-in-the-loop AI research workflow that plans analyses, executes them
                on BERDL, synthesizes findings with literature context, and captures lessons
                learned for future projects. Each project produces reusable skills, memory,
                and data products.
            </p>
            <p style="margin-top: var(--space-4);">
                <a href="/co-scientist" class="btn btn-primary">Learn More</a>
            </p>
        </div>
        <div class="card" style="border-left: 4px solid var(--accent-secondary);">
            <h2 style="margin-bottom: var(--space-4);">Research Observatory</h2>
            <p>
                Explore curated data collections across the BERDL lakehouse, browse
                completed research projects with full reports, and discover findings
                documented with figures, citations, and reproducible notebooks.
            </p>
            <p style="margin-top: var(--space-4);">
                <a href="/projects" class="btn btn-secondary">Explore Projects</a>
            </p>
        </div>
    </div>
</section>

<!-- Reusable Knowledge -->
<section class="section">
    <h2>Reusable Knowledge</h2>
    <p class="text-muted" style="margin-bottom: var(--space-6);">
        Knowledge compounds across projects. Each analysis adds to a growing base of
        skills, memory, and discoveries that accelerates future research.
    </p>
    <div class="grid grid-3">
        <a href="/skills" class="card" style="text-decoration: none;">
            <h3 style="color: var(--text-primary); margin-top: 0;">Skills</h3>
            <p class="text-small text-muted">{{ skill_count }} reusable tools for querying BERDL, searching literature, synthesizing findings, and more.</p>
        </a>
        <a href="/knowledge/pitfalls" class="card" style="text-decoration: none;">
            <h3 style="color: var(--text-primary); margin-top: 0;">Memory</h3>
            <p class="text-small text-muted">Pitfalls, performance tips, and query patterns captured from real analyses to avoid repeating mistakes.</p>
        </a>
        <a href="/knowledge/discoveries" class="card" style="text-decoration: none;">
            <h3 style="color: var(--text-primary); margin-top: 0;">Discoveries</h3>
            <p class="text-small text-muted">{{ discovery_count }} curated research findings documented with statistical evidence and biological context.</p>
        </a>
    </div>
</section>

<!-- Latest Discoveries -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">Latest Discoveries</h2>
        <a href="/knowledge/discoveries" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        {% for discovery in discoveries %}
        <article class="card">
            <div class="card-header">
                <a href="/projects/{{ discovery.project_tag }}" class="badge badge-project">{{ discovery.project_tag | replace('_', ' ') | title }}</a>
            </div>
            <h3 class="card-title">
                <a href="/knowledge/discoveries#{{ discovery.id }}">{{ discovery.title }}</a>
            </h3>
            <div class="card-content">
                <p>{{ discovery.content[:200] }}{% if discovery.content|length > 200 %}...{% endif %}</p>
            </div>
        </article>
        {% endfor %}
    </div>
</section>

<!-- Active Projects -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">Recent Projects</h2>
        <a href="/projects" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        {% for project in projects %}
        <article class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <a href="/projects/{{ project.id }}">{{ project.title | markdown_inline }}</a>
                </h3>
                {% if project.status.value == "Completed" %}
                <span class="badge badge-completed">{{ project.status.value }}</span>
                {% elif project.status.value == "In Progress" %}
                <span class="badge badge-in-progress">{{ project.status.value }}</span>
                {% else %}
                <span class="badge badge-proposed">{{ project.status.value }}</span>
                {% endif %}
            </div>
            <div class="card-content">
                <p>{{ project.research_question[:150] }}{% if project.research_question|length > 150 %}...{% endif %}</p>
            </div>
            <div class="card-footer">
                <div class="card-meta">
                    {% if project.notebooks %}
                    <span>{{ project.notebooks|length }} notebook{% if project.notebooks|length != 1 %}s{% endif %}</span>
                    {% endif %}
                    {% if project.visualizations %}
                    <span>{{ project.visualizations|length }} figure{% if project.visualizations|length != 1 %}s{% endif %}</span>
                    {% endif %}
                </div>
                <a href="/projects/{{ project.id }}" class="btn btn-secondary">View</a>
            </div>
        </article>
        {% endfor %}
    </div>
</section>

<!-- Featured Collections -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">BERDL Collections</h2>
        <a href="/collections" class="btn btn-secondary">View All</a>
    </div>

    <div class="grid grid-3">
        {% for coll in primary_collections %}
        <a href="/collections/{{ coll.id }}" class="card">
            <div class="card-header">
                <span style="font-size: 1.5rem;">{{ coll.icon | safe }}</span>
                <span class="badge" style="background: rgba(57, 212, 230, 0.15); color: #39d4e6;">Primary</span>
            </div>
            <h3 class="card-title" style="color: var(--text-primary);">{{ coll.name }}</h3>
            <p class="text-muted text-small" style="font-family: var(--font-mono);">{{ coll.id }}</p>
            <div class="card-content">
                <p class="text-small">{{ coll.description[:200] }}{% if coll.description|length > 200 %}...{% endif %}</p>
            </div>
            <div class="card-footer">
                {% if coll.scale_stats.tables %}
                <span class="text-small text-muted">{{ coll.scale_stats.tables }} tables</span>
                {% elif coll.key_tables %}
                <span class="text-small text-muted">{{ coll.key_tables|length }} tables</span>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
</section>
{% endblock %}
