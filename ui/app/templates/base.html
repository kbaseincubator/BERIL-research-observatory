<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>

    <!-- OpenGraph / SEO -->
    <meta property="og:title" content="{% block og_title %}{{ app_name }}{% endblock %}">
    <meta property="og:description" content="An AI co-scientist and research observatory for BERDL-scale microbial discovery.">
    <meta name="description" content="An AI co-scientist and research observatory for BERDL-scale microbial discovery.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,500;0,6..72,600;1,6..72,400&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', path='css/main.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <nav class="nav-container">
            <a href="/" class="logo">
                <span class="logo-icon">&#9670;</span>
                <span class="logo-text">Microbial Discovery Forge</span>
                <span class="badge" style="font-size: 0.6rem; margin-left: var(--space-2); background: rgba(57, 212, 230, 0.15); color: #39d4e6;">AI Co-Scientist</span>
            </a>

            <ul class="nav-links">
                <li><a href="/co-scientist" class="{% if request.url.path == '/co-scientist' %}active{% endif %}">Co-Scientist</a></li>
                <li class="nav-dropdown">
                    <a href="/projects" class="{% if request.url.path.startswith('/projects') or request.url.path.startswith('/collections') %}active{% endif %}">Observatory</a>
                    <ul class="dropdown-menu">
                        <li><a href="/projects">Projects</a></li>
                        <li><a href="/collections">Collections</a></li>
                        <li><a href="/knowledge/discoveries">Discoveries</a></li>
                        <li><a href="/community/contributors">Community</a></li>
                    </ul>
                </li>
                <li class="nav-dropdown">
                    <a href="/skills" class="{% if request.url.path.startswith('/skills') or request.url.path.startswith('/knowledge') %}active{% endif %}">Knowledge</a>
                    <ul class="dropdown-menu">
                        <li><a href="/skills">Skills</a></li>
                        <li><a href="/knowledge/pitfalls">Memory: Pitfalls</a></li>
                        <li><a href="/knowledge/performance">Memory: Performance</a></li>
                        <li><a href="/knowledge/ideas">Research Ideas</a></li>
                    </ul>
                </li>
                <li><a href="/about" class="{% if request.url.path == '/about' %}active{% endif %}">About</a></li>
            </ul>

            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>Microbial Discovery Forge</h4>
                <p class="footer-description">AI co-scientist and research observatory for BERDL-scale microbial discovery.</p>
                <p class="text-small text-muted" style="margin-top: var(--space-2);">
                    Maintained by <a href="mailto:psdehal@lbl.gov">Paramvir S. Dehal</a>
                </p>
            </div>
            <div class="footer-section">
                <h4>Observatory</h4>
                <ul class="footer-links">
                    <li><a href="/projects">Projects</a></li>
                    <li><a href="/collections">Collections</a></li>
                    <li><a href="/knowledge/discoveries">Discoveries</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Knowledge</h4>
                <ul class="footer-links">
                    <li><a href="/skills">Skills</a></li>
                    <li><a href="/knowledge/pitfalls">Pitfalls</a></li>
                    <li><a href="/knowledge/performance">Performance</a></li>
                    <li><a href="/knowledge/ideas">Research Ideas</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Resources</h4>
                <ul class="footer-links">
                    <li><a href="https://hub.berdl.kbase.us">BERDL JupyterHub</a></li>
                    <li><a href="/co-scientist">Co-Scientist</a></li>
                    <li><a href="/about#citation">How to Cite</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Built on <a href="https://www.kbase.us/" target="_blank">BERDL (KBase)</a>.
            {% if last_updated %}
                <span class="footer-updated">Last updated: {{ last_updated.strftime('%Y-%m-%d %H:%M UTC') }}</span>
            {% endif %}
            </p>
        </div>
    </footer>

    <!-- Lightbox overlay -->
    <div class="lightbox-overlay" id="lightbox">
        <button class="lightbox-close" aria-label="Close">&times;</button>
        <img src="" alt="Full size image">
    </div>

    {% block extra_js %}{% endblock %}

    <script>
        // Mobile menu toggle
        document.querySelector('.mobile-menu-toggle')?.addEventListener('click', function() {
            document.querySelector('.nav-links').classList.toggle('active');
            this.classList.toggle('active');
        });

        // Lightbox
        (function() {
            var overlay = document.getElementById('lightbox');
            var overlayImg = overlay.querySelector('img');
            var targets = document.querySelectorAll('.grid .card img, .notebook-container img, .markdown-content img');

            targets.forEach(function(img) {
                img.classList.add('lightbox-trigger');
                img.addEventListener('click', function() {
                    overlayImg.src = this.src;
                    overlayImg.alt = this.alt || 'Full size image';
                    overlay.classList.add('active');
                });
            });

            overlay.querySelector('.lightbox-close').addEventListener('click', function() {
                overlay.classList.remove('active');
            });

            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) overlay.classList.remove('active');
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') overlay.classList.remove('active');
            });
        })();

        // Anchor links on headings
        document.querySelectorAll('.section h2[id]').forEach(function(h2) {
            h2.addEventListener('click', function() {
                var url = window.location.origin + window.location.pathname + '#' + this.id;
                window.history.replaceState(null, '', '#' + this.id);
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url);
                }
            });
        });
    </script>
</body>
</html>
